
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Set up a WebSockets server in Node.js</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://quickstarts.postman.com/elements/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="G-GPC8QJXW1D"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="websockets_node"
                  title="Set up a WebSockets server in Node.js"
                  environment="web"
                  feedback-link="https://github.com/loopDelicious/pmquickstarts">
    
      <google-codelab-step label="Overview" duration="1">
        <p>WebSockets are great for building real-time functionality into web applications, such as communicating financial trading data or IoT sensor data.</p>
<p>The <a href="https://www.rfc-editor.org/rfc/rfc6455" target="_blank">WebSocket protocol</a> provides a way to exchange data between a client and server over a persistent connection. The data can be passed in both directions with low latency and overhead, and without breaking the connection. This means the server can independently send data to the client without the client having to request it, and vice versa.</p>
<p>In this tutorial, let&#39;s create a WebSocket server, and use Postman to send and receive messages across the WebSocket connection.</p>
<p>Watch this video:</p>
<iframe class="youtube-video" src="https://www.youtube.com/embed/e__oWJ4wNtw?rel=0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2 is-upgraded>Prerequisites</h2>
<ul>
<li><a href="https://nodejs.org/en/" target="_blank">Node.js</a> installed on your machine</li>
</ul>
<h2 class="checklist" is-upgraded>What You&#39;ll Learn</h2>
<ul class="checklist">
<li>how to run a WebSockets server locally</li>
<li>how to establish a WebSockets connection</li>
<li>how to send and receive WebSocket messages</li>
</ul>
<h2 is-upgraded>What You&#39;ll Need</h2>
<ul>
<li><a href="https://code.visualstudio.com/download" target="_blank">VSCode</a> Installed</li>
<li><a href="https://nodejs.org/en/download/" target="_blank">NodeJS</a> Installed</li>
</ul>
<h2 is-upgraded>What You&#39;ll Build</h2>
<ul>
<li>A WebSockets server in Node.js</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Create the Node.js server" duration="3">
        <p>In your terminal, make a new directory called <code>websockets</code>.</p>
<pre><code language="language-bash" class="language-bash">$ mkdir websockets
</code></pre>
<p>Navigate into the new directory.</p>
<pre><code language="language-bash" class="language-bash">$ cd websockets
</code></pre>
<p>Install <a href="https://www.npmjs.com/package/ws" target="_blank"><code>ws</code></a>, a WebSockets library for Node.js.</p>
<pre><code language="language-bash" class="language-bash">$ npm install ws
</code></pre>
<p>Installing the WebSockets library like this also initializes your Node.js project and creates a package where your project files are stored. Open the <code>websockets</code> directory using your preferred text editor, like VSCode. You should see the project files scaffolded as below.</p>
<p class="image-container"><img alt="One sub-directory and 2 files at the first level of the root directory" src="img/d664fbc2d9a18da4.png"></p>
<p>Look inside the <code>package.json</code> file to see the <code>ws</code> dependency. Add the <code>"type": "module"</code> to the <code>package.json</code> so we can load an ES module in the next step. Your <code>package.json</code> should look like the following.</p>
<pre><code language="language-json" class="language-json">{
  &#34;type&#34;: &#34;module&#34;,
  &#34;dependencies&#34;: {
    &#34;ws&#34;: &#34;^8.12.0&#34;
  }
}
</code></pre>
<p>In the root directory, create a file called <code>index.js</code> and paste the following code from the <a href="https://www.npmjs.com/package/ws" target="_blank"><code>ws</code></a> documentation for a &#34;Simple server&#34;. This code initializes the WebSockets server. Upon establishing a connection between the client and this server (once running), the server will send the message &#34;something&#34; to the client.</p>
<pre><code language="language-js" class="language-js">import { WebSocketServer } from &#34;ws&#34;;

const wss = new WebSocketServer({ port: 8080 });

wss.on(&#34;connection&#34;, function connection(ws) {
  ws.on(&#34;message&#34;, function message(data) {
    console.log(&#34;received: %s&#34;, data);
  });
  ws.send(&#34;something&#34;);
});
</code></pre>
<p>It&#39;s time to run our server locally from the command line.</p>
<pre><code language="language-bash" class="language-bash">$ node index.js
</code></pre>
<p>In the next step, let&#39;s begin sending and receiving messages.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Send and receive WebSocket messages" duration="3">
        <p>In Postman, select <strong>New &gt; WebSocket Request</strong> to open a new tab. Enter the WebSocket server URL. A WebSocket URL begins with <code>ws://</code> or <code>wss://</code> and our server is running on <code>localhost:8080</code>. Click <strong>Connect</strong>.</p>
<p class="image-container"><img alt="Connect to local server and receive a WebSocket message" src="img/d561f829ad42c7f2.png"></p>
<p>Once Postman establishes the connection to your local server, the <strong>Messages</strong> pane displays a list of messages for the WebSocket connection, including incoming, outgoing, and network messages. You can further inspect the connection details by clicking on &#34;Connected to ws://localhost:8080&#34;.</p>
<p class="image-container"><img alt="Inspect handshake details" src="img/71d94cd88f6df480.png"></p>
<p>The connection we established between the Postman client and local server is bidirectional. In addition to receiving messages, we can also send them. Under the <strong>Message</strong> tab, write your own message and <strong>Send</strong>.</p>
<p>If you have good reflexes, you may have seen your outgoing message in the <strong>Messages</strong> pane. If not, filter for the message using the controls or search bar in the <strong>Messages</strong> pane.</p>
<p class="image-container"><img alt="Filter or search for specific messages in the Messages pane" src="img/9bc61064c6a73bf2.png"></p>
<p>Verify the outgoing message was received by your local server.</p>
<p class="image-container"><img alt="Received messages are logged to the console of the local server" src="img/e8f8f7dd81bb6794.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Send system information" duration="3">
        <p>Let&#39;s update our WebSockets server to send something a little more interesting, like our computer&#39;s information, using the <a href="https://www.npmjs.com/package/systeminformation" target="_blank"><code>systeminformation</code></a> node package. Terminate the running server (<strong>Ctrl + C</strong>) and install the package from the command line.</p>
<pre><code language="language-bash" class="language-bash">$ npm install systeminformation
</code></pre>
<p>Import the package by adding the following code to the top of <code>index.js</code>.</p>
<pre><code language="language-js" class="language-js">import si from &#34;systeminformation&#34;;
</code></pre>
<p>Add the following code immediately after our WebSocket connection sends the string &#34;something&#34;. Every 1000 milliseconds, we will send a message about the current load on our CPU.</p>
<pre><code> setInterval(async () =&gt; {
    const cpuTemp = JSON.stringify(await si.currentLoad());
    ws.send(cpuTemp);
  }, 1000);
</code></pre>
<p>Save your changes, and restart the local server from the command line.</p>
<pre><code>node index.js
</code></pre>
<p>Return to Postman and <strong>Connect</strong> to the local server. This time we receive information about our CPU every second!</p>
<p class="image-container"><img alt="Local server sends CPU data every one second" src="img/fcd4faf3643ab4b0.png"></p>
<p>Click on a message to expand the message details and further inspect the data sent from our local server.</p>
<p class="image-container"><img alt="Expand message details" src="img/203daea34e15921b.png"></p>
<p>The messages will keep coming until you terminate the connection. Use Postman to <strong>Disconnect</strong> from the server.</p>
<p>Now that we have a functioning WebSocket server, we can do more things.</p>
<ul>
<li>Slow down the messages coming from the local server. Try updating <code>1000</code> milliseconds to <code>3000</code> milliseconds to see what happens.</li>
<li>Instead of sending all the data, try sending only the average load. You may want to inspect the messages in Postman to parse the data properly.</li>
</ul>
<p>We can write more code to customize our local application. Upon receiving a message from the client, we can do more than logging the message to the console. We can also retrieve data from other sources and perform calculations before sending our messages to the client.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Next Steps" duration="1">
        <p>More and more developers are exploring <a href="https://learning.postman.com/docs/sending-requests/websocket/websocket/" target="_blank">WebSocket APIs in Postman</a>. According to Postman&#39;s <a href="https://www.postman.com/state-of-api/api-technologies/#api-technologies" target="_blank">State of the API 2022</a> report, WebSockets are used by 26% of respondents.</p>
<p class="image-container"><img alt="WebSockets are used by 26% of survey respondents" src="img/4e19ef37e9995a6f.png"></p>
<h2 is-upgraded>Additional Resources</h2>
<p>Check out these Postman resources to learn more about WebSockets.</p>
<ul>
<li><a href="https://www.postman.com/postman/workspace/websockets/documentation/14057978-712d684f-c252-4bd9-a7a6-6a893e41adea" target="_blank">Guide to Postman WebSockets</a> collection</li>
<li><a href="https://learning.postman.com/docs/sending-requests/websocket/websocket/" target="_blank">Using WebSocket requests</a> docs</li>
<li><a href="https://youtu.be/H-7EZVj9D-k" target="_blank">WebSocket requests</a> video</li>
</ul>
<h2 is-upgraded>Next Steps</h2>
<p>You can use this starter application to explore how to use WebSockets with Internet of Things (IoT) devices and do neat stuff around the home.</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://quickstarts.postman.com/elements/codelab-elements/native-shim.js"></script>
  <script src="https://quickstarts.postman.com/elements/codelab-elements/custom-elements.min.js"></script>
  <script src="https://quickstarts.postman.com/elements/codelab-elements/prettify.js"></script>
  <script src="https://quickstarts.postman.com/elements/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>
  <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
    heap.load("2025084205");
  </script>
</body>
</html>
